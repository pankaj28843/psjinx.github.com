<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Blog - psjinx's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- for Google -->
    <meta description=" psjinx's personal blog ">
    <meta name="keywords" content='psjinx, pankaj singh, iit kharagpur, django, javascript, xamcheck, policy innovations, freelancer'>
    <meta name="author" content="Pankaj Singh">

    <!-- for Facebook -->
    <meta property="og:title" content="Blog - psjinx's blog" />
    <meta property="og:image" content="https://gravatar.com/avatar/d36fdce04734c18be6c97814ded214c2" />
    <meta property="og:url" content="http://psjinx.com/" />
    <meta property="og:description" content=" psjinx's personal blog " />

    <!-- for Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Blog - psjinx's blog" />
    <meta name="twitter:description" content=" psjinx's personal blog " />
    <meta name="twitter:image" content="https://gravatar.com/avatar/d36fdce04734c18be6c97814ded214c2" />

    <!-- Favicon -->
    <link href="http://psjinx.com/favicon.ico" rel="shortcut icon" />

    <!--Stylesheets-->
    <link rel="stylesheet" media="screen" type="text/css" href="http://psjinx.com/css/style.css" />
    <link rel="stylesheet" media="screen" type="text/css" href="http://psjinx.com/css/syntax.css" />

    <!--Atom Feed-->
    <link rel="alternate" type="application/atom+xml" title="Atom" href="http://psjinx.com/feed.xml" />

    <!-- Scripts-->
    <script type="text/javascript" src="http://psjinx.com/js/head.min.js"></script>
    <script type="text/javascript">
    //Google analytics
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12748803-5']);
    _gaq.push(['_trackPageview']);

    //Disqus
    var disqus_shortname = 'psjinx'; { %
        if site.auto %
    }
    var disqus_developer = 1; { %
        else %
    }
    head.js(
        "http://www.google-analytics.com/ga.js",
        "https://apis.google.com/js/plusone.js"
    ); { % endif %
    } { %
        if page.comments - count %
    }
    head.js("http://psjinx.disqus.com/count.js"); { % endif %
    } { %
        if page.comments %
    }
    head.js("http://psjinx.disqus.com/embed.js"); { % endif %
    }
    </script>
</head>

<body>
    <div id="header">
    <span class="byline">writing my thoughts...</span>
    <h1><a href="http://psjinx.com/">psjinx's blog</a></h1>
</div>

<div id="content">
    <div class="posts">
    
    <div class="post" itemscope itemtype="http://schema.org/Article">
    <h2 class="post-title" id="parsing-excel-workbooks-using-javascript">
    <a href="http://psjinx.com/programming/2014/01/04/parsing-excel-workbooks-using-javascript/">
        <span itemprop="name">Parsing excel workbooks using Javascript</span>
    </a>
    <span itemprop="url" style="display:none"><a href="http://psjinx.com/programming/2014/01/04/parsing-excel-workbooks-using-javascript/">http://psjinx.com/programming/2014/01/04/parsing-excel-workbooks-using-javascript/</a>
    </span>
</h2>
<div class="meta">
    <span class="date" itemprop="datePublished">
        <img alt="Posted on" src="http://psjinx.com/images/calendar.png" />04 Jan, 2014
    </span>
    <span class="share">
        <g:plusone size="small" href="http://psjinx.comhttp://psjinx.com/programming/2014/01/04/parsing-excel-workbooks-using-javascript/"></g:plusone>&nbsp;
    </span>
    <span class="tags" itemprop="keywords">
        
        <img alt="Tags" src="http://psjinx.com/images/tag.png" />
        <a href="http://psjinx.com/tags/xlsxjs">xlsxjs</a>
        
        <a href="http://psjinx.com/tags/xlsx">xlsx</a>
        
        <a href="http://psjinx.com/tags/javascript">javascript</a>
        
        <a href="http://psjinx.com/tags/excel">excel</a>
        
        <a href="http://psjinx.com/tags/workbook">workbook</a>
         
    </span>
    <span style="display:none;" itemprop="articleSection">Programming</span>
    <span itemprop="author" itemscope itemtype="http://schema.org/Person" style="display:none;">
        <span itemprop="name">Pankaj Singh</span>
        <img src="https://gravatar.com/avatar/d36fdce04734c18be6c97814ded214c2?r=x&s=200" itemprop="image" />
        <span itemprop="email">psjinx@gmail.com</span>
        <span itemprop="jobTitle">Programmer</span>
        <a href="http://psjinx.com" itemprop="url">psjinx.com</a>
    </span>
    <span itemprop="comment" itemscope itemtype="http://schema.org/UserComments" content="UserComments"><a class="comments" href="http://psjinx.com/programming/2014/01/04/parsing-excel-workbooks-using-javascript/#disqus_thread" data-disqus-identifier="parsing-excel-workbooks-using-javascript">Comments</a>
        <span style="display:none;"><a itemprop="replyToUrl" href="http://psjinx.com/programming/2014/01/04/parsing-excel-workbooks-using-javascript/#disqus_thread">http://psjinx.com/programming/2014/01/04/parsing-excel-workbooks-using-javascript/#disqus_thread</a></span>
    </span>
</div>

    <span itemprop="description" style="display:none;">A Javascript library for parsing .xlsx files. It includes sample code along with demo for integration with AngularJS. Use cases include listing sheet names for selection in a form, showing preview of selected sheet etc.</span>
    <div class='post-text' itemprop="articleBody">
         <p>Recently, I had to create a new web app, which would generate PDF reports based on data stored in excel worksheets. As usual, I used Django along with many other Python libraries for this.</p>

<p>I has following parts:</p>

<ol>
<li><strong>HTML Form -</strong> To select excel files and upload it to server</li>
<li><strong>Parsing uploaded excel file -</strong> Basic validation followed by reading data from worksheets. I used <code>xlrd</code> module from <a href="http://www.python-excel.org/">Python-Excel</a> project for this.</li>
<li><strong>Data analysis and plots -</strong> I used <a href="http://pandas.pydata.org/"><code>pandas</code></a>, Python Data Analysis Library, and <a href="http://matplotlib.org/"><code>matplotlib</code></a>, a python 2D plotting library, for this.</li>
<li><strong>PDF Generation -</strong> <a href="http://www.reportlab.com/software/rml-reference/"><code>RML</code></a> from <a href="http://www.reportlab.com/">ReportLab</a> along with awesomeness of <a href="https://docs.djangoproject.com/en/dev/ref/templates/">Django Templates</a> seems suitable for this job. I used <a href="https://github.com/zopefoundation/z3c.rml"><code>z3c.rml</code></a>, an open source implementation of <code>RML</code> standard by <a href="http://foundation.zope.org/">Zope Foundation</a>.</li>
</ol>


<p>So, everything was working like a charm, except the fact that web app was reading data from first worksheet by index whenever an excel workbook was uploaded. But, user should be able to tell which worksheet to read from, right?</p>

<p>For this, I needed to know sheet names for selected excel workbook and then show a select box to choose one sheet name. I also wanted to show data stored in that worksheet in a table, a preview.</p>

<p>After couple of Google searches for <em>"reading excel files using javascript"</em>, I landed up on homepage of <a href="http://oss.sheetjs.com/">SheetJS</a> project. They have two projects, <a href="https://github.com/SheetJS/js-xlsx"><code>js-xlsx</code></a> and <a href="https://github.com/SheetJS/js-xls"><code>js-xls</code></a>, but I did not get <strong><code>"for human beings"</code></strong> feeling from this <em>(if you have see <a href="https://gist.github.com/kennethreitz/973705">requests vs urllib2</a> then you know what I mean)</em>.</p>

<p>After 1-2 hours of walking through source code of <code>js-xlsx</code>, I ended up writing <a href="https://gist.github.com/psjinx/8002786">XLSX reader using javascript for humans</a>. Example code using this new library looks like:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#xlsxFile&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">sheets</span><span class="p">;</span>
        <span class="nx">XLSXReader</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xlsxData</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sheets</span> <span class="o">=</span> <span class="nx">xlsxData</span><span class="p">.</span><span class="nx">sheets</span><span class="p">;</span>
            <span class="c1">// Do somehting with sheets. It&#39;s a</span>
            <span class="c1">// Javascript object with sheet names</span>
            <span class="c1">// as keys and data as value in form of 2D array</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>


<p>I have integrated this <code>XLSXReader</code> in my web app along with <a href="http://angularjs.org/">AngularJS</a>. It consists of following parts:</p>

<ol>
<li><code>XLSXReaderService</code>, an angular app service, written on top of <code>XLSXReader</code>,</li>
<li><del>a web worker for reading excel files in a separate thread</del> Firefox does not support <code>FileReader</code> api for web workers, so not using it anymore,</li>
<li>an AngularJS controller along with HTML template.</li>
</ol>


<p>Code snippet for this integration is available at <a href="https://gist.github.com/psjinx/8252417">https://gist.github.com/psjinx/8252417</a>.</p>

<h3>Demo</h3>

<p>You can see a demo of above code snippet at <a href="http://code.psjinx.com/xlsx.js/">http://code.psjinx.com/xlsx.js/</a>.</p>

<h3>Use cases for this kind of library</h3>

<ol>
<li>Showing list of sheet names to choose from</li>
<li>Preview of data stored in worksheets</li>
<li>Integration with excel like data grid editors, e.g. <a href="http://handsontable.com/">Handsontable</a></li>
<li>Send JSON data to server instead of excel files</li>
<li>Integration with <a href="http://d3js.org/">D3.js</a> and a lot more</li>
</ol>


<p><em>P.S. - I have tested everything on Google Chrome and Mozilla Firefox only. Since, this web appliaction is for internal use, I don't have to deal with browser compatibility issues. But, it should work in all browsers supported by <a href="http://lodash.com/">Lodash</a> and SheetJS.</em></p>
 
    </div>
</div>

    
    <div class="post" itemscope itemtype="http://schema.org/Article">
    <h2 class="post-title" id="so-you-want-to-create-users-using-djangotastypie">
    <a href="http://psjinx.com/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/">
        <span itemprop="name">So, you want to create users using django-tastypie</span>
    </a>
    <span itemprop="url" style="display:none"><a href="http://psjinx.com/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/">http://psjinx.com/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/</a>
    </span>
</h2>
<div class="meta">
    <span class="date" itemprop="datePublished">
        <img alt="Posted on" src="http://psjinx.com/images/calendar.png" />07 Jun, 2013
    </span>
    <span class="share">
        <g:plusone size="small" href="http://psjinx.comhttp://psjinx.com/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/"></g:plusone>&nbsp;
    </span>
    <span class="tags" itemprop="keywords">
        
        <img alt="Tags" src="http://psjinx.com/images/tag.png" />
        <a href="http://psjinx.com/tags/django">django</a>
        
        <a href="http://psjinx.com/tags/django-tastypie">django-tastypie</a>
        
        <a href="http://psjinx.com/tags/rest-api">rest-api</a>
         
    </span>
    <span style="display:none;" itemprop="articleSection">Programming</span>
    <span itemprop="author" itemscope itemtype="http://schema.org/Person" style="display:none;">
        <span itemprop="name">Pankaj Singh</span>
        <img src="https://gravatar.com/avatar/d36fdce04734c18be6c97814ded214c2?r=x&s=200" itemprop="image" />
        <span itemprop="email">psjinx@gmail.com</span>
        <span itemprop="jobTitle">Programmer</span>
        <a href="http://psjinx.com" itemprop="url">psjinx.com</a>
    </span>
    <span itemprop="comment" itemscope itemtype="http://schema.org/UserComments" content="UserComments"><a class="comments" href="http://psjinx.com/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/#disqus_thread" data-disqus-identifier="so-you-want-to-create-users-using-djangotastypie">Comments</a>
        <span style="display:none;"><a itemprop="replyToUrl" href="http://psjinx.com/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/#disqus_thread">http://psjinx.com/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/#disqus_thread</a></span>
    </span>
</div>

    <span itemprop="description" style="display:none;">Building a RESTful api for user registration using django-tastypie. It includes a github project for Django 1.5 style custom User model along with explanation for each step.</span>
    <div class='post-text' itemprop="articleBody">
         <p>So lately, I have been thinking to write about what I learnt in past 5-6 months.
I will force myself to write something fun and useful every once in a while,
mostly related to Django for next few weeks.</p>

<p>I worked with <code>django-tastypie</code> for last 2-3 months to implement RESTful API
for iOS applications. It involved implementation of an end point for creating
new users.</p>

<p>This is not something which is really documented, so here I'm sharing my experience.
In a nutshell, we need to override <code>obj_create</code> method of <code>ModelResource</code> and do
some validation on posted data. After few iterations I ended up with a code
which is easily maintainable with future relases of <code>django-tastypie</code>.</p>

<h3>tl;dr</h3>

<ol>
<li>Check if all required fields are set in posted data.</li>
<li>Check if there is an existing user with same username or email address.</li>
<li>Validate posted data (e.g. password validation).</li>
<li>Set password from raw password.</li>
<li>Hide raw password from response.</li>
</ol>


<p>Let's dive in.</p>

<h3>Update</h3>

<p>I have created an <a href="https://github.com/psjinx/django-tastypie-custom-user-example">example project on Github</a>
for user registration. It uses Django 1.5, Custom user model and django-tastypie v0.10.0.</p>

<h3><code>UserProfile</code> model</h3>

<p><code>django-tastypie==0.9.14</code> and <code>Django 1.4.x</code> have been used for this example.
Since, support for custom User model was not very good in <code>django-tastypie</code> till
<code>v0.9.15</code>, I had to define <code>UserProfile</code> model in <code>Django 1.4.x</code> style.</p>

<p>Here is the code for <code>UserProfile</code> model:</p>

<script src="https://gist.github.com/5722079.js?file=models.py"> </script>


<h3>In case you need custom password validation</h3>

<p>If you have some rules for passwords then it's best to have that logic in a
function, because we may need to use that at different places (custom view
for resetting password?).</p>

<p>I defined following <code>validate_password</code> function which uses regular expressions:</p>

<script src="https://gist.github.com/5722079.js?file=utils.py"> </script>


<h3>Raising custom exception for bad http requests</h3>

<p>Format of JSON response for bad requests changed from <code>v0.9.12</code> to <code>v0.9.14</code> in
<code>django-tastypie</code> which caused some issues for iOS application we were building.
So, I wrote following custom class to solve this:</p>

<script src="https://gist.github.com/5722079.js?file=exceptions.py"> </script>


<h3>Model resources to manage user profiles</h3>

<p>I have defined 3 model resources as you can see in following code snippet:</p>

<ol>
<li><code>UserResource</code> - it uses <code>contrib.auth.models.User</code>.</li>
<li><code>CreateUserResource</code> - used for creating new <code>UserProfile</code>.</li>
<li><code>UserProfileResource</code> - used to <code>GET/PUT/PATCH</code> <code>UserProfile</code> objects.</li>
</ol>


<p>I had to define two resources for <code>UserProfile</code> model because creating new
user will be unauthenticated <code>POST</code> request but <code>GET/PUT/PATCH</code> need
<code>request.user</code> for filtering. Currently there is no support for specifying
authentication for each method method.</p>

<script src="https://gist.github.com/5722079.js?file=api.py"> </script>


<p>Following steps are involved in validating posted data:</p>

<ol>
<li><code>hydrate</code> method in <code>CreateUserResource</code> is used to check if required
fields are available in <code>bundle.data</code> or not.</li>
<li><code>obj_create</code> method in <code>CreateUserResource</code> is used to check if there is any
other user with same <code>email</code> and <code>username</code>.</li>
<li><code>hydrate</code> method in <code>UserResource</code> is used to validate <code>raw_password</code>.</li>
<li><code>dehydrate</code> method in <code>UserResource</code> is used to delete <code>raw_password</code> from</li>
</ol>


<p><b>You should also check if there is any other user with same <code>username</code> or <code>email</code>
if your app has option to update <code>username</code> or <code>email</code>. It can be done by
comparing <code>bundle.obj.username</code> with <code>bundle.data.get('username')</code> in <code>hydrate</code>
method of <code>UserResource</code>.</b></p>

<h3>Conclusion</h3>

<p>This simple implementation is easiliy maintainable. If you have any questions or
suggestions please post them in comments.</p>
 
    </div>
</div>

    
</div>

<div class="paginator">
    
    <span class="previous">Previous</span>
    
    <span class="page_number ">Page: 1 of 1</span>
    
    <span class="next ">Next</span>
    
</div>

</div>

<div id="sidebar">
    <ul>
        <li><a href="http://psjinx.com/">Blog</a></li>
        <li><a href="http://github.com/psjinx" target="_blank">Github</a></li>
        <li><a href="http://about.me/psjinx" target="_blank">About Me</a></li>
        <li><a href="http://psjinx.com/resume" target="_blank">Resume</a></li>
        <li><a href="https://djangogigs.com/developers/pankaj-singh/" target="_blank">Hire Me</a></li>
        <li>
            <a href="http://stackoverflow.com/users/353550/psjinx" style="background-color:#FBFBFB;"  target="_blank">
                <img src="http://stackoverflow.com/users/flair/353550.png?theme=clean" width="208" height="58" alt="profile for psjinx at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for psjinx at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
            </a>
        </li>
        <li style="padding-top:10px; padding-left:10px;"><script data-gittip-username="psjinx" src="//gttp.co/v1.js"></script></li>
        <li>
		  <a style="background-color:#FBFBFB;" href="http://feeds.feedburner.com/psjinx-blog" rel="alternate" type="application/rss+xml" target="_blank">
		    <img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" width="16" height="16" alt="" style="vertical-align:middle;border:0">
		    &nbsp;Subscribe in a reader
		  </a>
		</li>
		<li>
		  <a style="background-color:#FBFBFB;" href="http://feedburner.google.com/fb/a/mailverify?uri=psjinx-blog&amp;loc=en_US" target="_blank">
		    <img src="/images/mail.png" width="16" height="16" alt="" style="vertical-align:middle;border:0">
		    &nbsp;Subscribe via email
		  </a>
		</li>

    </ul>
</div>

<div id="footer">
    <p>
        <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" target="_blank"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a>
        Using <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>,
        <a href="http://pygments.org/" target="_blank">Pygments</a>
        | <a href="http://psjinx.com/sitemap.xml" target="_blank">Sitemap</a>
    </p>
</div>

    <a href="https://plus.google.com/+PankajSingh-aka-psjinx/" rel="author" style="display:none"></a>
</body>

</html>
