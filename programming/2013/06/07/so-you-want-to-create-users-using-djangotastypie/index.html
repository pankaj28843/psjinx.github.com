<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>So, you want to create users using django-tastypie - psjinx's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- for Google -->
    <meta description="Building a RESTful api for user registration using django-tastypie. It includes a github project for Django 1.5 style custom User model along with explanation for each step. ">
    <meta name="keywords" content='psjinx, pankaj singh, iit kharagpur, django, javascript, xamcheck, policy innovations, freelancer'>
    <meta name="author" content="Pankaj Singh">

    <!-- for Facebook -->
    <meta property="og:title" content="So, you want to create users using django-tastypie - psjinx's blog" />
    <meta property="og:image" content="https://gravatar.com/avatar/d36fdce04734c18be6c97814ded214c2" />
    <meta property="og:url" content="http://psjinx.com/" />
    <meta property="og:description" content="Building a RESTful api for user registration using django-tastypie. It includes a github project for Django 1.5 style custom User model along with explanation for each step. " />

    <!-- for Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="So, you want to create users using django-tastypie - psjinx's blog" />
    <meta name="twitter:description" content="Building a RESTful api for user registration using django-tastypie. It includes a github project for Django 1.5 style custom User model along with explanation for each step. " />
    <meta name="twitter:image" content="https://gravatar.com/avatar/d36fdce04734c18be6c97814ded214c2" />

    <!-- Favicon -->
    <link href="/favicon.ico" rel="shortcut icon" />

    <!--Stylesheets-->
    <link rel="stylesheet" media="screen" type="text/css" href="/css/style.css" />
    <link rel="stylesheet" media="screen" type="text/css" href="/css/syntax.css" />

    <!--Atom Feed-->
    <link rel="alternate" type="application/atom+xml" title="Atom" href="/feed.xml" />

    <!-- Scripts-->
    <script type="text/javascript" src="/js/head.min.js"></script>
    <script type="text/javascript">
    //Google analytics
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12748803-5']);
    _gaq.push(['_trackPageview']);

    //Disqus
    var disqus_shortname = 'psjinx'; { %
        if site.auto %
    }
    var disqus_developer = 1; { %
        else %
    }
    head.js(
        "http://www.google-analytics.com/ga.js",
        "https://apis.google.com/js/plusone.js"
    ); { % endif %
    } { %
        if page.comments - count %
    }
    head.js("http://psjinx.disqus.com/count.js"); { % endif %
    } { %
        if page.comments %
    }
    head.js("http://psjinx.disqus.com/embed.js"); { % endif %
    }
    </script>
</head>

<body>
    <div id="header">
    <span class="byline">writing my thoughts...</span>
    <h1><a href="/">psjinx's blog</a></h1>
</div>

<div id="content">
    
<div class="post">
    <h2 class="post-title" id="so-you-want-to-create-users-using-djangotastypie"><a href="/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/">So, you want to create users using django-tastypie</a></h2>
<div class="meta">
    <span class="date">
        <img alt="Posted on" src="/images/calendar.png"/> 07 Jun, 2013
    </span>
    <span class="share">
        <g:plusone size="small" href="http://www.psjinx.com/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/"></g:plusone>&nbsp;
    </span>
    <span class="tags" >
        
        <img alt="Tags" src="/images/tag.png"/>
        
        <a href="/tags/django">django</a>
        
        <a href="/tags/django-tastypie">django-tastypie</a>
        
        <a href="/tags/rest-api">rest-api</a>
        
        
    </span>

    <a class="comments" href="/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/#disqus_thread" data-disqus-identifier="so-you-want-to-create-users-using-djangotastypie">Comments</a>
</div>


    <div class='post-text'>
        
        <p>So lately, I have been thinking to write about what I learnt in past 5-6 months.
I will force myself to write something fun and useful every once in a while,
mostly related to Django for next few weeks.</p>

<p>I worked with <code>django-tastypie</code> for last 2-3 months to implement RESTful API
for iOS applications. It involved implementation of an end point for creating
new users.</p>

<p>This is not something which is really documented, so here I'm sharing my experience.
In a nutshell, we need to override <code>obj_create</code> method of <code>ModelResource</code> and do
some validation on posted data. After few iterations I ended up with a code
which is easily maintainable with future relases of <code>django-tastypie</code>.</p>

<h3>tl;dr</h3>

<ol>
<li>Check if all required fields are set in posted data.</li>
<li>Check if there is an existing user with same username or email address.</li>
<li>Validate posted data (e.g. password validation).</li>
<li>Set password from raw password.</li>
<li>Hide raw password from response.</li>
</ol>


<p>Let's dive in.</p>

<h3>Update</h3>

<p>I have created an <a href="https://github.com/psjinx/django-tastypie-custom-user-example">example project on Github</a>
for user registration. It uses Django 1.5, Custom user model and django-tastypie v0.10.0.</p>

<h3><code>UserProfile</code> model</h3>

<p><code>django-tastypie==0.9.14</code> and <code>Django 1.4.x</code> have been used for this example.
Since, support for custom User model was not very good in <code>django-tastypie</code> till
<code>v0.9.15</code>, I had to define <code>UserProfile</code> model in <code>Django 1.4.x</code> style.</p>

<p>Here is the code for <code>UserProfile</code> model:</p>

<script src="https://gist.github.com/5722079.js?file=models.py"> </script>


<h3>In case you need custom password validation</h3>

<p>If you have some rules for passwords then it's best to have that logic in a
function, because we may need to use that at different places (custom view
for resetting password?).</p>

<p>I defined following <code>validate_password</code> function which uses regular expressions:</p>

<script src="https://gist.github.com/5722079.js?file=utils.py"> </script>


<h3>Raising custom exception for bad http requests</h3>

<p>Format of JSON response for bad requests changed from <code>v0.9.12</code> to <code>v0.9.14</code> in
<code>django-tastypie</code> which caused some issues for iOS application we were building.
So, I wrote following custom class to solve this:</p>

<script src="https://gist.github.com/5722079.js?file=exceptions.py"> </script>


<h3>Model resources to manage user profiles</h3>

<p>I have defined 3 model resources as you can see in following code snippet:</p>

<ol>
<li><code>UserResource</code> - it uses <code>contrib.auth.models.User</code>.</li>
<li><code>CreateUserResource</code> - used for creating new <code>UserProfile</code>.</li>
<li><code>UserProfileResource</code> - used to <code>GET/PUT/PATCH</code> <code>UserProfile</code> objects.</li>
</ol>


<p>I had to define two resources for <code>UserProfile</code> model because creating new
user will be unauthenticated <code>POST</code> request but <code>GET/PUT/PATCH</code> need
<code>request.user</code> for filtering. Currently there is no support for specifying
authentication for each method method.</p>

<script src="https://gist.github.com/5722079.js?file=api.py"> </script>


<p>Following steps are involved in validating posted data:</p>

<ol>
<li><code>hydrate</code> method in <code>CreateUserResource</code> is used to check if required
fields are available in <code>bundle.data</code> or not.</li>
<li><code>obj_create</code> method in <code>CreateUserResource</code> is used to check if there is any
other user with same <code>email</code> and <code>username</code>.</li>
<li><code>hydrate</code> method in <code>UserResource</code> is used to validate <code>raw_password</code>.</li>
<li><code>dehydrate</code> method in <code>UserResource</code> is used to delete <code>raw_password</code> from</li>
</ol>


<p><b>You should also check if there is any other user with same <code>username</code> or <code>email</code>
if your app has option to update <code>username</code> or <code>email</code>. It can be done by
comparing <code>bundle.obj.username</code> with <code>bundle.data.get('username')</code> in <code>hydrate</code>
method of <code>UserResource</code>.</b></p>

<h3>Conclusion</h3>

<p>This simple implementation is easiliy maintainable. If you have any questions or
suggestions please post them in comments.</p>

        
    </div>
</div>



<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = 'so-you-want-to-create-users-using-djangotastypie';
        var disqus_title = 'So, you want to create users using django-tastypie';
        var disqus_url = 'http://www.psjinx.com/programming/2013/06/07/so-you-want-to-create-users-using-djangotastypie/';
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>


</div>

<div id="sidebar">
    <ul>
        <li><a href="/">Blog</a></li>
        <li><a href="http://github.com/psjinx" target="_blank">Github</a></li>
        <li><a href="http://about.me/psjinx" target="_blank">About Me</a></li>
        <li><a href="/resume" target="_blank">Resume</a></li>
        <li><a href="https://djangogigs.com/developers/pankaj-singh/" target="_blank">Hire Me</a></li>
        <li>
            <a href="http://stackoverflow.com/users/353550/psjinx" style="background-color:#FBFBFB;"  target="_blank">
                <img src="http://stackoverflow.com/users/flair/353550.png?theme=clean" width="208" height="58" alt="profile for psjinx at Stack Overflow, Q&A for professional and enthusiast programmers" title="profile for psjinx at Stack Overflow, Q&A for professional and enthusiast programmers">
            </a>
        </li>
        <li style="padding-top:10px; padding-left:10px;"><script data-gittip-username="psjinx" src="//gttp.co/v1.js"></script></li>
        <li>
		  <a style="background-color:#FBFBFB;" href="http://feeds.feedburner.com/psjinx-blog" rel="alternate" type="application/rss+xml" target="_blank">
		    <img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" width="16" height="16" alt="" style="vertical-align:middle;border:0">
		    &nbsp;Subscribe in a reader
		  </a>
		</li>
		<li>
		  <a style="background-color:#FBFBFB;" href="http://feedburner.google.com/fb/a/mailverify?uri=psjinx-blog&amp;loc=en_US" target="_blank">
		    <img src="/images/mail.png" width="16" height="16" alt="" style="vertical-align:middle;border:0">
		    &nbsp;Subscribe via email
		  </a>
		</li>  

    </ul>
</div>

<div id="footer">
    <p>
        <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" target="_blank"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a>
        Using <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>,
        <a href="http://pygments.org/" target="_blank">Pygments</a>
        | <a href="/sitemap.xml" target="_blank">Sitemap</a>
    </p>
</div>

    <a href="https://plus.google.com/+PankajSingh-aka-psjinx/" rel="author" style="display:none"></a>
</body>

</html>
